- name: Check Node Exporter Does Exist
  stat:
    path: /opt/node_exporter
  register: out

- name: Print
  debug:
    msg: "{{out}}"

- name: Print
  debug:
    msg: "{{ NODE_EXPORTER_URL | splitext }}"

#- name: Download Prometheus Archieve
#  ansible.builtin.unarchive:
#    src:
#    dest: /tmp
#    remote_src: yes
#
#- name: Copy Node Exporter to /opt
#  copy:
#    src: /tmp/node_exporter-1.2.2.linux-amd64
#    dest: /opt/node_exporter
#    remote_src: yes



#URL=$(curl -L -s https://prometheus.io/download/  | grep tar | grep node_exporter | grep linux-amd64  | sed -e "s|>| |g" -e 's|<|                                                                |g' -e 's|"| |g' |xargs -n1 | grep ^http)
##
##FILENAME=$(echo $URL | awk -F / '{print $NF}')
##DIRNAME=$(echo $FILENAME | sed -e 's/.tar.gz//')
##
##cd /opt
##curl -s -L -O $URL
##tar -xf $FILENAME
##rm -f $FILENAME
##mv $DIRNAME node_exporter
##
##curl -s https://raw.githubusercontent.com/linuxautomations/labautomation/master/tools/prometheus-node-exporter/prometheus.service                                                                >/etc/systemd/system/node_exporter.service
##systemctl enable node_exporter
##systemctl start node_exporter
##